# **"SiliconNebula"ä¸ªäººåšå®¢ç³»ç»Ÿ (Next.js + Strapi v5)**



### åå…«åŠ åå…«çš„ç½‘ç«™ç›®å‰å·²ç»å¼€æºå•¦ï¼ï¼ï¼æš‚å®šåä¸º**SiliconNebula**ï¼ˆ**ç¡…åŸæ˜Ÿäº‘**ï¼‰`(ï½¡â€¢Ì€á´—-)âœ§ è¯¶å˜¿~

### åŸä½œè€…ç½‘ç«™ï¼š[www.wuyilin18.top](https://www.wuyilin18.top/)ï¼Œå¦‚æœä½ å–œæ¬¢çš„è¯å¯ä»¥å¸®æˆ‘ç‚¹ä¸€ä¸ªå…è´¹çš„StarğŸŒŸğŸŒŸğŸŒŸå“¦ï¼



### ğŸš§ğŸš§ğŸš§æœ¬å¼€æºé¡¹ç›®ä¸å¤ªé€‚åˆçº¯å°ç™½ï¼Œéœ€è¦ä¸€å®šçš„â€œå‰ç«¯â€å’Œâ€åç«¯â€œï¼ˆæ¬¡è¦ï¼‰ç»éªŒåŸºç¡€ï¼Œå› æ­¤å®‰è£…ä¹‹å‰åŠ¡å¿…æœ‰ä¸€å®šçš„Next.jsåŸºç¡€å’ŒStrapiåç«¯æ¯”è¾ƒç†Ÿæ‚‰ï¼Œä¸ç†Ÿæ‚‰çš„æœ‹å‹å»ºè®®æå‰ç†Ÿæ‚‰[Next.jsä¸­æ–‡æ–‡æ¡£](https://www.nextjs.cn/docs)å’Œ[strapiä¸­æ–‡æ–‡æ¡£](https://www.strapi.cn/dev-docs/intro)ï¼Œè¯·å…ˆç†Ÿæ‚‰äº†è§£å®Œåç«¯çš„strapiæ–‡æ¡£ï¼Œåˆ«ä¸Šæ¥å°±é—®æ–‡ç« æ€ä¹ˆå†™ï¼ï¼ï¼é¿å…å„ç§ä¸å¿…è¦çš„éº»çƒ¦ï¼ï¼ï¼æœ›å‘¨çŸ¥ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼



### ğŸš§ğŸš§ğŸš§ç‰¹åˆ«æ³¨æ„ï¼ï¼ï¼

### **å› ä¸ºä¸ºäº†æ§åˆ¶å°ç¾è§‚ï¼Œæ‰€æœ‰è°ƒè¯•æ—¥å¿—éƒ½è¢«æˆ‘æ³¨é‡Šæ‰äº†ï¼Œåœ¨éƒ¨ç½²å‰è¯·å…ˆæŠŠå‰åç«¯ä»£ç ä¸­çš„æ—¥å¿—çš„æ³¨é‡Šåˆ æ‰ï¼Œåˆ æ‰æ‰€æœ‰`console.log`å‰çš„æ³¨é‡Šç¬¦å·ï¼Œå»ºè®®åœ¨VsCodeé‡Œæœç´¢`console.log`ï¼Œç„¶åæŠŠæ‰€æœ‰æ³¨é‡Šç¬¦å·éƒ½ç»™åˆ äº†ï¼Œä»¥æ–¹ä¾¿è°ƒè¯•ã€‚å‰ç«¯å’Œåç«¯é¡¹ç›®å¼ºçƒˆå»ºè®®å…ˆåœ¨æœ¬åœ°è°ƒè¯•å®Œäº†åœ¨éƒ¨ç½²åˆ°Vercelå’ŒæœåŠ¡å™¨ä¸Šã€‚(Â´â–½`)ï¾‰ **



## æ•ˆæœå›¾

![åšå®¢ç³»ç»Ÿç¤ºä¾‹å›¾](https://cdn.wuyilin18.top/img/%E5%8D%9A%E5%AE%A2%E6%95%88%E6%9E%9C%E5%9B%BE.webp)



ä¸‹é¢æ˜¯ä¸€ä»½è¯¦ç»†çš„å‰åç«¯åˆ†ç¦»ä¸ªäººåšå®¢ç³»ç»Ÿçš„READMEæ–‡æ¡£ï¼ŒåŒ…å«äº†æ‰€æœ‰å…³é”®é…ç½®é¡¹çš„è¯´æ˜ã€‚

## é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ä¸ªäººåšå®¢ç³»ç»Ÿï¼Œé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼š
- **å‰ç«¯**ï¼šNext.js (Reactæ¡†æ¶) - éƒ¨ç½²åœ¨Vercel

- **åç«¯**ï¼šStrapi v5 (æ— å¤´CMS) - éƒ¨ç½²åœ¨äº‘æœåŠ¡å™¨

- **æœç´¢å¼•æ“**ï¼šAlgolia

- **è¯„è®ºç³»ç»Ÿ**ï¼šTwikoo - éƒ¨ç½²åœ¨Vercel

  


## ç¯å¢ƒè¦æ±‚

- Node.js 18.x æˆ–æ›´é«˜ç‰ˆæœ¬
- npm 9.x æˆ–æ›´é«˜ç‰ˆæœ¬
- PostgreSQL 12+ (æ¨è) æˆ– SQLite (å¼€å‘ç”¨)
- Redis (å¯é€‰ï¼Œç”¨äºç¼“å­˜)

### 

## é¡¹ç›®ç»“æ„

```bash
blog-system/
â”œâ”€â”€ frontend/          # Next.js å‰ç«¯åº”ç”¨
â”œâ”€â”€ backend/           # Strapi v5 åç«¯åº”ç”¨
â””â”€â”€ README.md          # é¡¹ç›®æ–‡æ¡£
```

## 1. å‰ç«¯é…ç½® (Next.js)

### å®‰è£…ä¸è¿è¡Œ

```bash
cd frontend
npm install
# æˆ–è€… yarn install
npm run dev
```

### ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env.local` æ–‡ä»¶å¹¶é…ç½®ä»¥ä¸‹å˜é‡ï¼š

```env
# åŸºç¡€é…ç½®

# æœ¬åœ°æ¨¡å¼
NEXT_PUBLIC_STRAPI_URL=https://ä½ çš„strapiåå°ç«¯å£
NEXT_PUBLIC_STRAPI_API_TOKEN=ä½ çš„strapiåå°tokenç§˜é’¥

# Strapi åç«¯é…ç½®
NEXT_PUBLIC_STRAPI_API_URL=http://localhost:1337  # å¼€å‘ç¯å¢ƒ
# NEXT_PUBLIC_STRAPI_API_URL=https://your-api-domain.com # ç”Ÿäº§ç¯å¢ƒ
NEXT_PUBLIC_STRAPI_API_TOKEN=your_strapi_api_token_here

# Algolia æœç´¢é…ç½®
NEXT_PUBLIC_ALGOLIA_APP_ID=your_algolia_app_id
NEXT_PUBLIC_ALGOLIA_SEARCH_API_KEY=your_algolia_search_api_key
NEXT_PUBLIC_ALGOLIA_INDEX_NAME=blog_posts

# Twikoo è¯„è®ºç³»ç»Ÿé…ç½®
NEXT_PUBLIC_TWIKOO_URL=https://twikoo.yourdomain.com
TWIKOO_ENV_ID=your_vercel_environment_id
```

### å…¶ä»–é…ç½®

ä¿®æ”¹`next.config.js`æ–‡ä»¶

```js
/** @type {import('next').NextConfig} */
const nextConfig = {
  reactStrictMode: true,
  images: {
    domains: ["localhost", "ä½ çš„å›¾æºcdn"],//<---ä¿®æ”¹è¿™é‡Œ
    remotePatterns: [
      {
        protocol: "http",
        hostname: "localhost",
        port: "1337",
        pathname: "/uploads/**",
      },
    ],
    unoptimized: true, // ç¦ç”¨Next.jså›¾ç‰‡ä¼˜åŒ–ï¼Œç›´æ¥åŠ è½½åŸå§‹å›¾ç‰‡
  },
};

module.exports = nextConfig;
```

ä¿®æ”¹`next.config.ts`æ–‡ä»¶

```ts
import type { NextConfig } from "next";
import webpack from "webpack";

// æå‰åŠ è½½ sharp é€‚é…å™¨ï¼ˆåŒæ­¥åŒ–å¤„ç†ï¼‰
// eslint-disable-next-line @typescript-eslint/no-explicit-any
let sharpAdapter: any;

// åˆå§‹åŒ– sharpAdapter
(async () => {
  try {
    // ä½¿ç”¨åŠ¨æ€å¯¼å…¥æ›¿ä»£ require
    const sharpModule = await import("responsive-loader/sharp");
    sharpAdapter = sharpModule.default;
  } catch {
    // eslint-disable-next-line no-console
    console.warn(
      "responsive-loader/sharp not found, falling back to default loader"
    );
  }
})();

const nextConfig: NextConfig = {
  // ç¦ç”¨ç±»å‹æ£€æŸ¥
  typescript: {
    ignoreBuildErrors: true,
  },
  // å›¾ç‰‡cdnæ¥æº
  images: {
    domains: ["localhost", "127.0.0.1", "ä½ çš„å›¾ç‰‡cdnæ¥æº"],//<---ä¿®æ”¹è¿™é‡Œ
    deviceSizes: [640, 750, 1080, 1200, 1920],
    imageSizes: [16, 32, 48, 64, 96],
    minimumCacheTTL: 86400,
    formats: ["image/webp"],
  },

  // ä¿®æ”¹ webpack é…ç½®ä¸ºåŒæ­¥
  webpack: (config, { isServer, dev }) => {
    if (!dev && !isServer && sharpAdapter) {
      config.module.rules.push({
        test: /\.(png|jpg|jpeg|webp)$/i,
        use: [
          {
            loader: "responsive-loader",
            options: {
              adapter: sharpAdapter,
              sizes: [300, 600, 1200, 2000],
              placeholder: true,
              placeholderSize: 20,
              cacheDirectory: true,
              cacheIdentifier: "responsive-loader",
            },
          },
        ],
      });
    }

    config.plugins.push(
      new webpack.IgnorePlugin({
        resourceRegExp: /^\.\/locale$/,
        contextRegExp: /moment$/,
      })
    );

    return config;
  },
};

export default nextConfig;

```



### å…³é”®æ–‡ä»¶ä½ç½®

- Algolia æœç´¢é…ç½®ï¼š`frontend/lib/algolia.ts`
- Strapi API è¯·æ±‚ï¼š`frontend/lib/strapi.ts`
- Twikoo ç»„ä»¶ï¼š`frontend/components/Comments/TwikooComments.tsx`

### éƒ¨ç½²åˆ° Vercel

1. å°†ä»£ç æ¨é€åˆ°GitHubä»“åº“
2. ç™»å½• [Vercel](https://vercel.com/) å¹¶å¯¼å…¥é¡¹ç›®
3. åœ¨ç¯å¢ƒå˜é‡è®¾ç½®ä¸­æ·»åŠ æ‰€æœ‰ `NEXT_PUBLIC_*` å˜é‡
4. éƒ¨ç½²é¡¹ç›®

## 2. åç«¯é…ç½® (Strapi v5)

### å®‰è£…ä¸è¿è¡Œ

```bash
cd backend
npm install
# æˆ–è€… yarn install
npm run develop
```

### ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env` æ–‡ä»¶å¹¶é…ç½®ä»¥ä¸‹å˜é‡ï¼š

```env
# åº”ç”¨é…ç½®
HOST=0.0.0.0
PORT=1337
APP_KEYS=your_app_keys_comma_separated
API_TOKEN_SALT=your_api_token_salt
ADMIN_JWT_SECRET=your_admin_jwt_secret
JWT_SECRET=your_jwt_secret

# å…¬å…± URLï¼ˆé‡è¦ï¼ï¼‰
PUBLIC_URL=https://ä½ çš„strapiåå°è®¿é—®ç«¯å£

# æ•°æ®åº“é…ç½®
DATABASE_CLIENT=sqlite
DATABASE_FILENAME=.tmp/data.db

# Algolia é›†æˆ
ALGOLIA_APP_ID=your_algolia_app_id
ALGOLIA_API_KEY=your_algolia_admin_api_key
ALGOLIA_INDEX_NAME=blog_posts

# å…¶ä»–é…ç½®
NODE_ENV=production
```

### Algolia é›†æˆæ’ä»¶å®‰è£…

1. å®‰è£… Strapi Algolia æ’ä»¶ï¼š
```bash
npm install strapi-plugin-algolia
```

2. åœ¨ `backend/config/plugins.ts` ä¸­æ·»åŠ é…ç½®ï¼š

```ts
export default ({ env }) => ({
  // å…¶ä»–æ’ä»¶é…ç½®...
  // Algoliaæ’ä»¶é…ç½®
  "strapi-algolia": {
    enabled: true,
    config: {
      apiKey: env("ALGOLIA_SEARCH_API_KEY"),
      applicationId: env("ALGOLIA_APP_ID"),
      indexPrefix: process.env.ALGOLIA_INDEX_PREFIX || "strapi",
      contentTypes: [
        {
          name: "api::post.post",
          index: "development_blog_posts", //ä½ çš„algoliaç´¢å¼•åç§°
          transform: (data) => {
            const baseUrl = process.env.PUBLIC_URL;
            let coverImageUrl = "";
            if (data.CoverImage?.url) {
              coverImageUrl = data.CoverImage.url.startsWith("http")
                ? data.CoverImage.url
                : `${baseUrl}${data.CoverImage.url}`;
            }

            return {
              objectID: data.id.toString(),
              title: data.Title || "",
              slug: data.Slug || "",
              summary: data.Summary || "",
              content: parseRichTextForAlgolia(data.Content), // Use the local parser
              coverImage: coverImageUrl,
              categories: data.categories?.map((cat) => cat.name) || [],
              tags: data.tags?.map((tag) => tag.name) || [],
            };
          },
          populate: {
            Content: true,
            CoverImage: true,
            categories: true,
            tags: true,
          },
        },
      ],
    },
  },
});
```

### éƒ¨ç½²åˆ°äº‘æœåŠ¡å™¨

1. å‡†å¤‡äº‘æœåŠ¡å™¨ï¼ˆUbuntu 20.04+ æ¨èï¼‰
2. å®‰è£… Node.js, npm, PostgreSQL
3. é…ç½®é˜²ç«å¢™å¼€æ”¾1337ç«¯å£
4. ä½¿ç”¨PM2ç®¡ç†è¿›ç¨‹ï¼š

```bash
npm install -g pm2
pm2 start npm --name "strapi" -- run start
pm2 save
pm2 startup
```

5. é…ç½®Nginxåå‘ä»£ç†ï¼š

```nginx
server {
    listen 80;
    server_name api.yourdomain.com;
    
    location / {
        proxy_pass http://localhost:1337;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

## 3. Twikoo è¯„è®ºç³»ç»Ÿé…ç½®

### éƒ¨ç½²åˆ° Vercel

1. åˆ›å»ºæ–°çš„Vercelé¡¹ç›®
2. é€‰æ‹©Twikooæ¨¡æ¿ï¼š[https://github.com/twikoojs/twikoo](https://github.com/twikoojs/twikoo)
3. éƒ¨ç½²æ—¶è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```env
# MongoDB é…ç½®
MONGODB_URI=mongodb+srv://<username>:<password>@cluster0.xxxxx.mongodb.net/twikoo?retryWrites=true&w=majority

# ç®¡ç†å¯†ç 
TWIKOO_ADMIN_PASS=your_admin_password
```

### åœ¨å‰ç«¯é›†æˆ

åœ¨è¯„è®ºç»„ä»¶`TwikooComments.tsx`ä¸­æ·»åŠ ï¼š

```tsx
  const initTwikoo = () => {
    if (containerRef.current && window.twikoo) {
      // console.log(`[Twikoo] Initializing for path: ${pathname}`);
      try {
        containerRef.current.innerHTML = "";

        // åœ¨è¿™é‡Œå†™ä½ çš„ HTTPS åœ°å€
        const finalEnvId = "https://ä½ éƒ¨ç½²åœ¨vercelçš„twikooçš„httpsåœ°å€";
        // console.log(`[Twikoo] Using hardcoded envId: ${finalEnvId}`);

        window.twikoo.init({
          envId: finalEnvId,
          el: "#twikoo-comments-container",
          path: pathname,
          lang: "zh-CN",
          provider: "vercel",
        });
        // console.log("[Twikoo] Init function called successfully.");
      } catch (e) {
        console.error("[Twikoo] Error during init:", e);
      }
    }
  };
```

## 4. å…³é”®å®‰å…¨é…ç½®

### API Token ç®¡ç†

1. **Strapi API Token**:
   - ç™»å½•Strapiåå°
   - è®¾ç½® â†’ API Tokens â†’ åˆ›å»ºæ–°Token
   - é€‰æ‹©"Full access"æˆ–è‡ªå®šä¹‰æƒé™
   - åœ¨å‰ç«¯`.env.local`ä¸­ä½¿ç”¨æ­¤Token

2. **Algolia API Keys**:
   - ä½¿ç”¨Search-Only API Keyåœ¨å‰ç«¯
   - ä½¿ç”¨Admin API Keyåœ¨åç«¯
   - åœ¨Algoliaæ§åˆ¶å°é™åˆ¶å¯†é’¥æƒé™

3. **Strapi JWT å¯†é’¥**:
   - ä½¿ç”¨å¼ºå¯†ç ç”Ÿæˆå™¨åˆ›å»º
   - é•¿åº¦è‡³å°‘32ä¸ªå­—ç¬¦
   - å®šæœŸè½®æ¢

### å®‰å…¨æœ€ä½³å®è·µ

- æ°¸è¿œä¸è¦å°†æ•æ„Ÿå¯†é’¥æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- ä½¿ç”¨ä¸åŒçš„å¯†é’¥ç”¨äºå¼€å‘å’Œç”Ÿäº§ç¯å¢ƒ
- å®šæœŸè½®æ¢APIå¯†é’¥å’Œè®¿é—®ä»¤ç‰Œ
- åœ¨äº‘æœåŠ¡å™¨ä¸Šé…ç½®é˜²ç«å¢™è§„åˆ™ï¼Œä»…å¼€æ”¾å¿…è¦ç«¯å£
- ä¸ºæ•°æ®åº“è®¾ç½®å¼ºå¯†ç å¹¶å¯ç”¨SSLè¿æ¥

## 5. å†…å®¹æ›´æ–°æµç¨‹

### æ·»åŠ æ–°åšå®¢æ–‡ç« 

1. ç™»å½•Strapiç®¡ç†åå°
2. è¿›å…¥Content Manager â†’ Posts
3. åˆ›å»ºæ–°å†…å®¹
4. ä¿å­˜å¹¶å‘å¸ƒ
5. æ–°æ–‡ç« å°†è‡ªåŠ¨åŒæ­¥åˆ°Algolia

### æ›´æ–°ç½‘ç«™é…ç½®

1. ä¿®æ”¹å‰ç«¯ä»£ç åæ¨é€åˆ°GitHub
2. Vercelä¼šè‡ªåŠ¨é‡æ–°éƒ¨ç½²
3. æ›´æ–°Strapiå†…å®¹åï¼Œéœ€æ¸…é™¤å‰ç«¯ç¼“å­˜ï¼š
   - åœ¨Vercelé¡¹ç›®ä¸­è§¦å‘é‡æ–°éƒ¨ç½²
   - æˆ–è®¾ç½®ISRï¼ˆå¢é‡é™æ€å†ç”Ÿï¼‰

## **æ•…éšœæ’é™¤**

### å¸¸è§é—®é¢˜

1. **Algoliaæœç´¢æ— ç»“æœ**:
   - æ£€æŸ¥Algoliaæ’ä»¶é…ç½®
   - ç¡®è®¤Strapiå†…å®¹å·²å‘å¸ƒ
   - åœ¨Algoliaæ§åˆ¶å°æ£€æŸ¥ç´¢å¼•å†…å®¹

2. **Twikooè¯„è®ºæ— æ³•åŠ è½½**:
   - æ£€æŸ¥Verceléƒ¨ç½²çŠ¶æ€
   - ç¡®è®¤MongoDBè¿æ¥æ­£å¸¸
   - éªŒè¯å‰ç«¯ç¯å¢ƒå˜é‡é…ç½®

3. **Strapiéƒ¨ç½²åæ— æ³•è®¿é—®**:
   - æ£€æŸ¥äº‘æœåŠ¡å™¨é˜²ç«å¢™è®¾ç½®
   - æŸ¥çœ‹PM2æ—¥å¿—ï¼š`pm2 logs strapi`
   - ç¡®è®¤æ•°æ®åº“è¿æ¥é…ç½®æ­£ç¡®

## æŠ€æœ¯æ”¯æŒ

å¦‚é‡æŠ€æœ¯é—®é¢˜ï¼Œè¯·æäº¤Issueï¼š
[å‰åç«¯é—®é¢˜](https://github.com/wuyilin18/BlogWebsite-SiliconNebula/issues)

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [MIT è®¸å¯è¯](LICENSE)

```

## è¡¥å……è¯´æ˜

### å…³é”®é…ç½®é¡¹æ€»ç»“

1. **å‰ç«¯ç¯å¢ƒå˜é‡**:
   - Strapi API URL å’Œ Token
   - Algolia App IDã€Search Key å’Œ Index Name
   - Twikoo æœåŠ¡ URL

2. **åç«¯ç¯å¢ƒå˜é‡**:
   - æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
   - Algolia Admin API Key
   - SMTP é‚®ä»¶æœåŠ¡é…ç½®
   - JWT å¯†é’¥å’Œ API Token Salt

3. **Twikoo é…ç½®**:
   - MongoDB è¿æ¥ URI
   - ç®¡ç†å‘˜å¯†ç 

### å®‰å…¨å»ºè®®

- æ‰€æœ‰æ•æ„Ÿå¯†é’¥éƒ½åº”ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†
- ç”Ÿäº§ç¯å¢ƒç¦ç”¨ Strapi çš„å…¬å…±æ³¨å†Œ
- å®šæœŸå¤‡ä»½æ•°æ®åº“
- ä½¿ç”¨ HTTPS åŠ å¯†æ‰€æœ‰è¿æ¥
- é™åˆ¶ API è®¿é—®æƒé™ï¼ˆIP ç™½åå•ã€é€Ÿç‡é™åˆ¶ï¼‰

### æ€§èƒ½ä¼˜åŒ–

1. **å‰ç«¯**:
   - ä½¿ç”¨ Next.js çš„ ISG (å¢é‡é™æ€ç”Ÿæˆ)
   - å®ç°å›¾ç‰‡æ‡’åŠ è½½
   - æ·»åŠ ç¼“å­˜æ§åˆ¶å¤´

2. **åç«¯**:
   - å¯ç”¨ Strapi ç¼“å­˜
   - ä½¿ç”¨ Redis ç¼“å­˜é¢‘ç¹è®¿é—®çš„æ•°æ®
   - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢

3. **æœç´¢**:
   - è°ƒæ•´ Algolia æ’åè®¾ç½®
   - ä½¿ç”¨æŸ¥è¯¢å»ºè®®
   - é…ç½®åŒä¹‰è¯

è¿™ä¸ª README æä¾›äº†å®Œæ•´çš„é¡¹ç›®é…ç½®å’Œéƒ¨ç½²æŒ‡å—ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®å®é™…ç¯å¢ƒä¿®æ”¹æ‰€æœ‰å¿…è¦çš„ API å¯†é’¥ã€Token å’Œ IDã€‚